#!/bin/sh
#
# Start the udhcpd server ....
#

mkdir -p /var/lib/misc

case "$1" in
  start)
        printf "Starting udhcpd: "
        if [ ! -e /var/lib/misc/udhcpd.leases ]
        then
            echo "" > /var/lib/misc/udhcpd.leases
        fi
        ipaddr=$(ifconfig wlan0 | awk '/inet addr/ {sub("addr:",""); print $2}')
        /usr/sbin/udhcpd -I $ipaddr -S /etc/udhcpd.conf
        [ $? = 0 ] && echo "OK" || echo "FAIL"
        ;;
  stop)
        printf "Stopping udhcpd: "
        pid=$(pidof udhcpd)
        if [ $pid ]
        then
            kill -9 $pid
        fi
        [ $? = 0 ] && echo "OK" || echo "FAIL"
        ;;
  restart|reload)
        "$0" stop
        "$0" start
        ;;
  *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
esac

exit $?
